/**
* Init Class
*/

(function ($, window, document, undefined) {

	$("input#placa").change(function() {
		// Check input( $( this ).val() ) for validity here
	   var placa = $(this).val();
       
       if(placa != undefined && placa != null && placa != '') {
            $.ajax({
                type: 'GET',
                cache: false,
                dataType: 'json',
                data:  {'placa' : placa},
                url : 'server.php?action=getdetail',
                beforeSend: function() { 
                    $("#validation-errors-ticket").hide().empty();                                     
                    $("#success-ticket").hide().empty();                                     
                    
                    // Clear info
                    $("#placa-info").hide();                                     
                    $("#cliente_nombre").text('');
                    $("#serial_maquina").text('');
                    $("#marca_maquina").text('');
                    $("#modelo_maquina").text('');
                    $("#ubicacion_maquina").text('');
                    $("#direccion_maquina").text('');
                },
                success: function(data) {
                    if(data.success == false) {
                        $("#validation-errors-ticket").append(data.msg);
                        $("#validation-errors-ticket").show();
                    }else{
                        // Set data
                        $("#cliente_nombre").text(data.machine.client_nit + ' - ' + data.machine.client_name);
                        $("#serial_maquina").text(data.machine.machine_serial);
                        $("#marca_maquina").text(data.machine.mark_name);
                        $("#modelo_maquina").text(data.machine.model_name);
                        $("#ubicacion_maquina").text(data.machine.municipio_nombre);
                        $("#direccion_maquina").text(data.machine.area_address);

                        $("#placa-info").show();
                    }
                },
                error: function(xhr, textStatus, thrownError) {
                    $("#validation-errors-ticket").hide().empty();
                    $("#validation-errors-ticket").hide().empty("No hay respuesta del servidor - Consulte al administrador.");                                     
                }
            });	
       }
	});

	$('#form-add-ticket').on('submit', function(event){                             
        event.preventDefault();
        var url = $(this).attr('action');

        $.ajax({
            type: 'POST',
            cache: false,
            dataType: 'json',
            data:  $('#form-add-ticket').serialize(),
            url : url,
            beforeSend: function() { 
                $("#validation-errors-ticket").hide().empty();                                     
                $("#success-ticket").hide().empty();                                     
            },
            success: function(data) {
                if(data.success == false) {
                    $("#validation-errors-ticket").append(data.msg);
                    $("#validation-errors-ticket").show();
                }else{
                    // Clear form
                    $("#placa").val('');
                    $("#email").val('');
                    $("#confirm_email").val('');
                    $("#solicita").val('');
                    $("#telefono").val('');
                    $("#problema").val('');
                    $("#descripcion").val('');
                    $("#prioridad").val('');
                    $("#placa-info").hide(); 

                    // Set message success
                	$("#success-ticket").append(data.msg);
                    $("#success-ticket").show();
                }
            },
            error: function(xhr, textStatus, thrownError) {
                $("#validation-errors-ticket").hide().empty();
                $("#validation-errors-ticket").hide().empty("No hay respuesta del servidor - Consulte al administrador.");                                     
			}
        });
        return false;
    });

})(jQuery, this, this.document);
